#textdomain wesnoth-Rise_of_the_Elementalist

#define APPLY_ERUPTION_MASK NUMBER
    [terrain_mask]
        x=17
        y=11
        mask="{~add-ons/Rise_of_the_Elementalist/masks2/Volcano{NUMBER}.mask}"
    [/terrain_mask]
    {REDRAW_MACRO}
#enddef
#define APPLY_ERUPTION_MASK_DELAY NUMBER
    [delay]
        time=750
    [/delay]
    {APPLY_ERUPTION_MASK {NUMBER}}
#enddef
#define APPLY_ERUPTION_MASK_EARTHQUAKE NUMBER DELAY
    [delay]
        time={DELAY}
    [/delay]
    {EARTHQUAKE (
        {APPLY_ERUPTION_MASK {NUMBER}}
    )}
#enddef

[scenario]
    id=07_Eruption
    name=_ "Eruption"
    map_data="{~add-ons/Rise_of_the_Elementalist/maps2/Volcano.map}"
    turns=50
    next_scenario=08_Orc_Enlistment
    victory_when_enemies_defeated=yes

    # Simulate a day turned to night by ash
    {SECOND_WATCH}
    {DAWN}
    {DUSK}
    {FIRST_WATCH}
    {FIRST_WATCH}
    {SECOND_WATCH}

    {DEFAULT_MUSIC_PLAYLIST}

    [story]
        [part]
            story=_ "You waste no time, knowing that your victory is near. With an erruption of the volcano, you know that the ash will block the sun out, taking away the advantage of the surface dwellers. Using your control of the fire as well as all of your fire and lava elementals, you prepare a ritual. As you release the power you have built up, the magma pushes up from the depths..."
        [/part]
    [/story]

    [side]
        side=1
        no_leader=yes
        save_id=lotd
        team_name=demon
        user_team_name=_ "You"
        gold=200
        controller=human
        recruit=Fire Wisp,Rock Pile,Whirlwind,Minor Lava Elemental,Troll Whelp
    [/side]

    {SIDE_COMPUTER 2 enemies (_ "Humans") 300 0 (
        type=Grand Knight
        random_traits=yes
        canrecruit=yes
        recruit=Horseman,Knight,Longbowman,Javelineer,Swordsman,Pikeman,Spearman
        {GENERIC_UNIT 2 "Paladin" 9 9}
        {LOYAL_GUARDIAN_UNIT 2 "Iron Mauler" 34 24}
        {LOYAL_GUARDIAN_UNIT 2 "Iron Mauler" 36 23}
    ) (
        grouping=defensive
    )}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 2 "Knight" 2}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 2 "Longbowman" 2}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 2 "Swordsman" 2}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 2 "Pikeman" 2}
    {STARTING_VILLAGES 2 15}

    {SIDE_COMPUTER 3 enemies (_ "Dwarves") 300 0 (
        type=Dwarvish Lord
        random_traits=yes
        canrecruit=yes
        recruit=Dwarvish Steelclad,Dwarvish Thunderguard,Dwarvish Fighter,Dwarvish Thunderer
        {GENERIC_UNIT 3 "Dwarvish Dragonguard" 8 4}
        {LOYAL_GUARDIAN_UNIT 3 "Dwarvish Sentinel" 10 13}
        {LOYAL_GUARDIAN_UNIT 3 "Dwarvish Sentinel" 11 12}
    ) ()}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 3 "Dwarvish Steelclad" 3}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 3 "Dwarvish Thunderguard" 3}
    {STARTING_VILLAGES 3 15}

    [event]
        name=prestart

        {SET_OBJECTIVES 1 () (_ "Note: the ash from the volcano has blocked the sun, as a result there will be no day."+"
" {EARLY_FINISH_BONUS_NOTE}+{NEW_GOLD_CARRYOVER_NOTE_40}) (
            {VICTORY_CONDITION (_ "Kill the enemy leaders")}
            {DEFEAT_CONDITION (_ "Death of Kil'rathacar")}
            {DEFEAT_CONDITION (_ "Turns run out")}
        )}
    [/event]

    [event]
        name=start

        {MSG (x,y=9,9) (_ "200 gold? You are kidding! That is much too high a price for those weapons.")}
        {MSG (x,y=7,5) (_ "It is getting harder to get the ore. A demon is loose in the caves below and has destroyed several of our mines.")}
        {MSG (x,y=9,9) (_ "And how is it that this is our problem?")}
        {MSG (x,y=8,4) (_ "Lousy human, first, if you want the goods, it is your problem as that is our price. Secondly do not think that this demon is not going to visit the surface at some point?")}
        {MSG (x,y=37,26) (_ "Offer them 175 and be done with it, we need to get back.")}

        {QUAKE "rumble.ogg"}
        {MSG (x,y=9,9) (_ "Whoa, what was that?")}
        {SCROLL_TO 23 17}
        {APPLY_ERUPTION_MASK_EARTHQUAKE 1 1}
        {MSG (x,y=10 13) (_ "What is going on?!")}
        {SCROLL_TO 23 17}
        {APPLY_ERUPTION_MASK_EARTHQUAKE 2 1}
        {APPLY_ERUPTION_MASK_EARTHQUAKE 3 1000}
        {APPLY_ERUPTION_MASK_EARTHQUAKE 4 1000}
        {APPLY_ERUPTION_MASK_EARTHQUAKE 5 1000}
        {APPLY_ERUPTION_MASK_DELAY 6}
        {APPLY_ERUPTION_MASK_DELAY 7}
        {APPLY_ERUPTION_MASK_DELAY 8}
        {APPLY_ERUPTION_MASK_DELAY 9}
        [delay]
            time=750
        [/delay]
        [recall]
            id=lotd
            x,y=23,17
        [/recall]

        {MSG (id=lotd) (_ "Prepare to die dwarves! And what have we here? Stockier than elves, yet thinner than a dwarves, you must be humans. Not that it really matters, you shall die as well.")}
        {MOVE_UNIT id=lotd 21 18}
        {APPLY_ERUPTION_MASK 10}

        # Recall the loyal troll if still around:
        [recall]
            upkeep=loyal
            race=Troll
        [/recall]
        
        {MSG (x,y=8,4) (_ "I hate to tell you that I told you so, but...")}
        {MSG (x,y=9,9) (_ "I get the point.")}
        {MSG (x,y=37,26) (_ "What say you dwarves, care to show us the strength of that steel in battle and we will settle on 200?")}
        {MSG (x,y=7,5) (_ "Agreed.")}
    [/event]

    [event]
        name=last breath
        [filter]
            canrecruit=yes
            side=2
        [/filter]
        {MSG (speaker=unit) (_ "We should have sent for reinforcements.")}
    [/event]

    [event]
        name=last breath
        [filter]
            canrecruit=yes
            side=3
        [/filter]
        {MSG (speaker=unit) (_ "This demon is unstoppable...")}
    [/event]

    [event]
        name=victory
        {MSG (id=lotd) (_ "We must now find the Orcs and make our army unstoppable.")}
    [/event]
[/scenario]
